function coloredMap(){url="./eto/"+YYYY+"/"+MM+"/"+DD+".json",d3.json(url,function(t){var e={};$.each(t,function(t,a){key=a.weather_station.zip,value=a.eto,e[key]=value,createTable(key,value)}),d3.json("austinzips.geojson",function(t,a){function n(t){return eto=e[t],void 0!==eto?"q"+Math.min(8,~~(36*eto))+"-9":void 0}$.each(a.features,function(t,e){zips.append("path").datum(e.geometry).attr("id",e.properties.NAME).attr("d",path).attr("class",n(e.properties.NAME))})})})}function getYesterdaysDate(){var t=new Date;t.setDate(t.getDate()-1),DD=t.getDate(),MM=t.getMonth()+1,YYYY=t.getFullYear()}function createTable(t,e){var a=$("<tr>"),n=$("<td>").text(t),o=$("<td>").text(Math.round(100*e)/100+"in.");a.append(n),a.append(o),$("#table-data").append(a)}function header(){$("#map-title").text(function(){return"eto"===mapType?"Calculated Evapotranspiration":void 0}),$("#date-title").text(MM+"-"+DD+"-"+YYYY)}var width=1e3,height=1e3,center=[-97.72409,30.279262],YYYY,MM,DD,mapType="eto",projection,path,svg,zips,url;$("#map-form").on("submit",function(t){t.preventDefault(),date=$("#map-date").val().split("-"),YYYY=date[0],MM=date[1],DD=date[2],mapType=$("#map-date").val(),$(".zips").html(""),coloredMap(),header()}),$("#map").attr("width",width).attr("height",height),projection=d3.geo.conicConformal().center(center).clipAngle(180).scale(9e4).translate([width/2,height/2]),path=d3.geo.path().projection(projection),svg=d3.select("#map").append("svg").attr({width:width,height:height}),zips=svg.append("g").attr({"class":"zips",transform:"translate(-300, 450) rotate(-53)"}),getYesterdaysDate(),coloredMap(),header();